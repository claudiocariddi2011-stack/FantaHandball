<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FantaHandball</title>
<style>
body{margin:0;font-family:Arial;background:#0f172a;color:#e5e7eb;padding-bottom:70px}
header{background:#020617;padding:16px;text-align:center;font-size:24px;font-weight:bold}
.screen{display:none;padding:20px;max-width:600px;margin:auto}
.active{display:block}
.card{background:#1e293b;border-radius:10px;padding:12px;margin-bottom:10px;cursor:pointer}
.btn{background:#22c55e;color:#022c22;border:none;padding:8px 14px;border-radius:8px;font-weight:bold;cursor:pointer}
input{width:100%;padding:8px;border-radius:6px;border:none;margin-bottom:10px}
nav{position:fixed;bottom:0;left:0;right:0;background:#020617;display:flex;justify-content:space-around;padding:10px}
nav button{background:none;border:none;color:#e5e7eb;font-size:14px}
</style>
</head>
<body>
<header>FantaHandball</header>

<section id="login" class="screen active">
  <h2>Login</h2>
  <input id="usernameInput" placeholder="Il tuo nome">
  <button class="btn" id="loginBtn">Entra</button>
</section>

<section id="home" class="screen">
  <h2 id="welcome"></h2>
  <input id="leagueName" placeholder="Nome nuova lega">
  <button class="btn" id="createLeagueBtn">Crea Lega</button>
  <h3>Leghe disponibili</h3>
  <div id="leagues"></div>
</section>

<nav>
  <button onclick="showScreen('home')">Home</button>
</nav>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
// CONFIG FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyCTqPPwpfNElGluzwjv9nsy8EYBzJUXm2M",
  authDomain: "fantahandaball.firebaseapp.com",
  projectId: "fantahandaball",
  storageBucket: "fantahandaball.firebasestorage.app",
  messagingSenderId: "346312156685",
  appId: "1:346312156685:web:13cee4784534ad7f95d744"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// VARIABILI GLOBALI
let username = '';
let currentLeague = '';

// NAVIGAZIONE
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// LOGIN
function login() {
  const name = document.getElementById('usernameInput').value.trim();
  if (!name) {
    alert('Inserisci il nome');
    return;
  }
  username = name;
  document.getElementById('welcome').innerText = 'Ciao ' + username;
  showScreen('home');
  renderLeagues();
}

// CREA LEGA (SALVATA SU FIREBASE)
async function createLeague() {
  const leagueName = document.getElementById('leagueName').value.trim();
  if (!leagueName) {
    alert('Inserisci il nome della lega');
    return;
  }

  const ref = db.collection('leagues').doc(leagueName);
  const snap = await ref.get();

  if (snap.exists) {
    alert('Questa lega esiste giÃ ');
    return;
  }

  await ref.set({
    owner: username,
    members: [username],
    createdAt: new Date()
  });

  currentLeague = leagueName;
  document.getElementById('leagueName').value = '';
  alert('Lega creata con successo');
}

// MOSTRA LE LEGHE (IN TEMPO REALE)
function renderLeagues() {
  const container = document.getElementById('leagues');

  db.collection('leagues').onSnapshot(snapshot => {
    container.innerHTML = '';
    snapshot.forEach(doc => {
      const league = doc.data();
      const div = document.createElement('div');
      div.className = 'card';
      div.innerText = doc.id + ' - ' + league.members.length + ' squadre';
      div.onclick = () => joinLeague(doc.id);
      container.appendChild(div);
    });
  });
}

// ENTRA IN UNA LEGA
async function joinLeague(name) {
  const ref = db.collection('leagues').doc(name);
  const snap = await ref.get();
  if (!snap.exists) return;

  let members = snap.data().members;
  if (!members.includes(username)) {
    members.push(username);
    await ref.update({ members });
  }

  currentLeague = name;
  alert('Sei entrato nella lega ' + name);
}

// EVENTI
document.getElementById('loginBtn').addEventListener('click', login);
document.getElementById('createLeagueBtn').addEventListener('click', createLeague);
</script>
</body>
</html>



